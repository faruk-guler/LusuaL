################################################################################
# İsim: Linux Güvenlik Denetimi
# Amaç: Sistemdeki potansiyel yetki yükseltme ve erişim zafiyetleri tespiti
#
################################################################################

# 1.1. SUID/SGID Bitli Dosyaları Tespit Et (Yetki Yükseltme Riski)
# Not: Bu dosyaların incelenmesi ve gereksiz olanların yetkisinin kaldırılması gerekir.
find / -type f \( -perm -04000 -o -perm -02000 \)

# 1.2. Herkesin Yazmasına Açık Dosyaları Tespit Et (Bütünlük Riski)
# Not: Bu dosyaların izinleri (o-w) ile kısıtlanmalıdır.
find / -perm -2 ! -type l -ls

# 1.3. Sahibi Olmayan (Orphan) Dosyaları Tespit Et (Temizlik ve Güvenilirlik)
# Not: Bu dosyalar ya silinmeli ya da mevcut bir kullanıcıya atanmalıdır (chown).
find / \( -nouser -o -nogroup \) -print

# 1.4. .rhosts Dosyalarını Tespit Et (Eski Uzaktan Erişim Riski)
# Not: Bu dosyalar, SSH anahtarları kullanılmıyorsa, derhal silinmelidir.
find /home -name .rhosts -print

# 2.1. Dosya Yeteneklerini (Capabilities) Kontrol Et
# Not: SUID/SGID'nin modern alternatifi olan ayrıcalıkları bulur.
getcap -r / 2>/dev/null

# 2.2. ACL (Erişim Kontrol Listesi) Ayarlı Dosyaları Bul
# Not: Geleneksel izinleri aşan özel kuralları olan dosyaları bulur.
find / -acl -print

# 2.3. Kritik Dosyaların İzinlerini Kontrol Et (Örnek: /etc/shadow)
# Not: /etc/shadow sadece 'root' tarafından okunabilir olmalıdır (0000 veya 400).
ls -l /etc/passwd /etc/shadow

# 2.4. Yazılabilir PATH Dizinlerini Kontrol Et (Yetki Yükseltme Riski)
# Not: PATH'teki dizinlere normal kullanıcı yazabiliyorsa ciddi risktir.
find $(echo $PATH | tr ':' ' ') -writable 2>/dev/null

# 3.1. Hangi Kullanıcının Hangi Portu Dinlediğini Bul (Süreç Yetkisi)
# Not: root tarafından dinlenen gereksiz portlar risk oluşturur.
ss -tulpn | grep LISTEN

# 3.2. Root Olarak Çalışan Tüm Süreçleri Görüntüle
# Not: Gereksiz veya bilinmeyen bir servisin root olarak çalışıp çalışmadığını kontrol eder.
ps aux | grep root

# 4.5. Yapışkan Biti Olmayan Herkese Açık Dizinleri Kontrol Et
# Not: Herkesin yazabildiği ancak başkasının dosyasını silmesini engelleyen (yapışkan bit) kuralının olmadığı dizinleri arar. /tmp haricinde bu durum zafiyet yaratabilir.
find / -type d -perm -2 -a ! -perm -1000 -ls

# 5.5. Root'un Ev Dizini İzinlerini Kontrol Et
# Not: Root'un ev dizini ve SSH anahtarlarının sadece 'root' tarafından erişilebilir olduğunu doğrular.
ls -ld /root; ls -l /root/.ssh/authorized_keys

# 6.3. Sadece Root'un Sahibi Olduğu Cron İşlerini Görüntüle
# Not: Sistem genelindeki zamanlanmış görev dosyalarının yetkisiz kişilerce değiştirilmediğini kontrol eder.
ls -l /etc/cron.d /etc/crontab /etc/anacrontab

# 4.1. Boş Parolalı Kullanıcıları Kontrol Et
# Not: Parolası boş olan, sisteme kolayca giriş yapılabilecek kullanıcıları listeler (ikinci alan '!' veya 'x' değilse).
awk -F: '($2 == "") {print}' /etc/shadow

# 4.2. UID 0 (Root Yetkisi) Olan Kullanıcıları Kontrol Et
# Not: Sadece 'root' kullanıcısının UID'si 0 olmalıdır. Birden fazla UID 0 kullanıcısı yetki yükseltme riskidir.
awk -F: '($3 == "0") {print}' /etc/passwd

# 4.3. Herkesin Okuyabileceği Kabuk Geçmişi Dosyalarını Bul
# Not: Başka kullanıcıların komut geçmişini okuyabilme zafiyetini arar.
find /home -name .bash_history -perm /o=r -ls

# 4.4. Sudo Yetkisine Sahip Kullanıcıları Kontrol Et
# Not: Sudo yetkisine sahip kullanıcı sayısını ve yetki tanımlarını inceler.
grep -E 'ALL=(ALL)' /etc/sudoers /etc/sudoers.d/*

# 6.1. Boş Parola Kısıtlamasını Kontrol Et
# Not: Boş parolayla giriş yapılmasını engelleyen kritik PAM (Pluggable Authentication Modules) ayarını kontrol eder.
grep 'nullok' /etc/pam.d/*

# 5.1. Değişmez (Immutable) Niteliğe Sahip Dosyaları Bul (chattr)
# Not: chattr +i ile değiştirilemez hale getirilmiş kritik dosyaları listeler. Bu iyi bir uygulamadır, ancak kötü amaçlı yazılımlar da kullanabilir.
lsattr -R /etc 2>/dev/null | grep 'i'

# 5.2. Kritik Günlük Dizinlerinin İzinlerini Kontrol Et
# Not: Günlük dosyalarına yetkisiz erişimi veya silinmeyi önler. /var/log/secure gibi günlüklerin root dışında yazılabilir olmaması gerekir.
ls -ld /var/log; ls -l /var/log/wtmp /var/log/btmp

# 5.3. Yüklü Modülleri Görüntüle
# Not: Rootkit'ler veya yetkisiz işlemler gizlenmek için çekirdek modüllerini kullanabilir. Bilinmeyen modüller risk teşkil eder.
lsmod

# 5.4. Kernel (Çekirdek) Güvenlik Ayarlarını Kontrol Et (sysctl)
# Not: Sistem genelindeki ağ ve bellek güvenliği ayarlarını kontrol eder (Örn: IP spoofing, execshield).
sysctl -a | grep -E 'net.ipv4.conf.all.rp_filter|kernel.exec-shield|kernel.randomize_va_space'

# 6.4. Kullanıcıların Ev Dizinlerinin İzinlerini Kontrol Et
# Not: Ev dizinlerinin, kullanıcının kendisi dışında diğer kullanıcılara yazma izni verip vermediğini denetler. (rwx------ veya rwxr-xr-x olmalı, w herkes için olmamalı)
find /home -maxdepth 1 -type d -perm /o=w -exec ls -ld {} \;

# 6.5. Servis Dosyalarının İzinlerini Kontrol Et
# Not: Systemd hizmetlerinin (servislerin) yetkisiz kişilerce değiştirilmediğini kontrol eder.
ls -l /etc/systemd/system/*.service /lib/systemd/system/*.service 2>/dev/null

################################################################################
